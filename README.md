# Harmony

**Harmony** (LANL code number C22093) is a finite element ALE code for solving the equations of fluid dynamics for single-material flows with arbitrary mesh motion in three dimensional geometry. The ALE methodology involves a Lagrangian step where the velocity and internal energy are updated and the mesh is allowed to move according to the local flow velocity. The Lagrangian method in Harmony is a finite element staggered grid hydrodynamic formulation for unstructured meshes with hexahedral zones, as described in LANL Technical Report LA-UR-13-26741. Artificial viscosity and hourglass control models are part of the Lagrangian calculation, and the details of these models are presented in LA-UR-13-26741. The discrete equations of the Lagrangian method are implemented using a set of mesh data structures including sides, corners, edges and faces, as described in UCRL-JC-118306. The Lagrangian step is followed by mesh relaxation and a remap step where the mesh quality is improved and material is redistributed across zone boundaries. Two kinds of mesh relaxation are supported: pure Eulerian mesh relaxation and Winslow equipotential mesh relaxation. Harmony has a second-order accurate swept-face remap which uses flux volume centroids and is a 3D extension of the method described in LA-UR-12-00799. When running in purely Lagrangian mode, Harmony supports simulations on unstructured meshes, but ALE simulations are supported only on logically structured meshes. Harmony has an ideal gas equation of state model. Harmony is intended for parallel simulations using the MPI standard. In addition to the finite element code several other codes are provided to perform support functions: (1) creating a mesh and partitioning it among the MPI ranks, (2) finding the mesh connectivity among the MPI ranks, (3) creating the mesh data structures for each MPI rank including sides, corners, edges and faces, and (4) assembling the graphics files generated by Harmony on each MPI rank into a single file suitable for viewing with Ensight or Paraview. Harmony is written in C++, and the supporting programs are written in either C or C++. Three example problems are provided in the distribution: the Kidder, Sedov and Triple Point problems. Each of these example problems has an input file called hydro.input, and in each case the mesh is partitioned across four MPI ranks. The examples provided here are single material versions of the corresponding test problems described in LA-UR-20-29893. The Kidder problem is a Lagrangian test problem, while the other two problems are Eulerian. All of the technical reports referenced above are provided in the documentation directory.
```

## Building the code
The user should create a new directory where the compiled code will reside.  
```
mkdir bin
```
Next, go to the folder and, for a default build, type
```
cmake ..
```
To compile the code type
```
make -j
```
The Harmony executable is called  sgh_hydro_3d and is located in the bin/Source/sgh_hydro folder.
```


## Running an example problem
Each example problem has a folder. The user should copy this folder to a suitable location. Within this folder there is the input file and two executable shell scripts. There is also a mesh directory, and within the mesh directory there is a shell script called mesh_script. The user should execute mesh_script first. This script will create the mesh, partition the mesh among four MPI ranks, and for each rank create a mesh file containing the definitions for the mesh data structures. The user should specify the path to the Harmony directory in each of the script files: mesh_script, run_script, and process_script. The run_script calls MPI and executes the simulation. The process_script generates an folder called ensight, which contains a graphics file for the simulation results which can be viewed using Ensight or Paraview.
```

